<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An overview of donut • donut</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An overview of donut">
<meta property="og:description" content="donut">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">donut</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/donut-vignette.html">An overview of donut</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/paulnorthrop/donut/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>An overview of donut</h1>
                        <h4 data-toc-skip class="author">Paul
Northrop</h4>
            
            <h4 data-toc-skip class="date">2023-09-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/paulnorthrop/donut/blob/HEAD/vignettes/donut-vignette.Rmd" class="external-link"><code>vignettes/donut-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>donut-vignette.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="nearest-neighbour-search-with-variables-on-a-torus">Nearest Neighbour Search with Variables on a Torus<a class="anchor" aria-label="anchor" href="#nearest-neighbour-search-with-variables-on-a-torus"></a>
</h2>
<p>A non-parametric method for classification or regression involves
making inferences locally using the <span class="math inline">\(k\)</span> observations closest to a point of
interest, based on some metric, such as L2 or L1. There are several R
packages, such as <strong>RANN</strong> <span class="citation">(Arya et
al. 2019)</span> and <strong>nabor</strong> <span class="citation">(Elseberg et al. 2012)</span>, that find <span class="math inline">\(k\)</span> nearest neighbours. The
<strong>donut</strong> package considers the situation where one or more
of the variables in the dataset is periodic on a finite interval. For
example, direction is periodic on the interval <span class="math inline">\((0, 360)\)</span> degrees. In the small dataset
<span class="math inline">\(\{10, 90, 350\}\)</span> degrees 350 is
closer to 10 than is 90: 10 and 350 are separated by 20 degrees, 10 and
90 by 80 degrees.</p>
<p>The function <code><a href="../reference/nnt.html">nnt()</a></code> finds the <span class="math inline">\(k\)</span> nearest neighbours of each of a set of
points of interest, wrapping periodic variables on a torus so that this
periodicity is reflected. The user chooses the function to use to find
the nearest neighbours. The nearest neighbour functions from the
aforementioned packages are used as examples.</p>
<div class="section level3">
<h3 id="an-example">An example<a class="anchor" aria-label="anchor" href="#an-example"></a>
</h3>
<p>We use a simple 2-dimensional example from the
<code><a href="https://rdrr.io/pkg/RANN/man/nn2.html" class="external-link">RANN::nn2()</a></code> documentation. For the purposes of illustrating
<code><a href="../reference/nnt.html">nnt()</a></code> we will suppose that one of more of the variables in
periodic. In one or two dimensions the plot method associated with
<code><a href="../reference/nnt.html">nnt()</a></code> can be used to show the effect of taking this
periodicity into account.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paulnorthrop/donut" class="external-link">donut</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">20092019</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">DATA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span></code></pre></div>
<p>First, we suppose that only <code>x1</code> should be wrapped, on the
range <span class="math inline">\((0, 2\pi)\)</span>. We use a small
number of query points of interest, chosen to illustrate the wrapping.
By default <code><a href="https://rdrr.io/pkg/RANN/man/nn2.html" class="external-link">RANN::nn2()</a></code>, which uses the L2 metric, is used
to find the nearest neighbours. In the plot, query points are indicated
with colour-coded crosses and the 8 nearest neighbours of each point are
shaded in the same colour. The wrapping of the variable <code>x1</code>
is apparent.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jefferis/RANN" class="external-link">RANN</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'RANN' was built under R version 4.2.3</span></span>
<span><span class="va">ranges1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span></span>
<span><span class="va">query1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nnt.html">nnt</a></span><span class="op">(</span><span class="va">DATA</span>, <span class="va">query1</span>, k <span class="op">=</span> <span class="fl">8</span>, torus <span class="op">=</span> <span class="fl">1</span>, ranges <span class="op">=</span> <span class="va">ranges1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res1</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="donut-vignette_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>The object returned from <code><a href="../reference/nnt.html">nnt()</a></code> is a list including the
same components that are returned from <code><a href="https://rdrr.io/pkg/RANN/man/nn2.html" class="external-link">RANN::nn2()</a></code> and
<code><a href="https://rdrr.io/pkg/nabor/man/knn.html" class="external-link">nabor::knn()</a></code>, that is, matrices containing the nearest
neighbour distances (<code>nn.dists</code>) and the corresponding
indices in <code>data</code> (<code>nn.idx</code>). The <span class="math inline">\(i\)</span>th row relates to the <span class="math inline">\(i\)</span>th query point, the <span class="math inline">\(i\)</span>th row of <code>query</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res1</span><span class="op">$</span><span class="va">nn.dists</span></span>
<span><span class="co">#&gt;            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]</span></span>
<span><span class="co">#&gt; [1,] 0.15704522 0.3501943 0.4310847 0.4397544 0.4685137 0.4767617 0.4819253</span></span>
<span><span class="co">#&gt; [2,] 0.43932258 0.5283214 0.5716203 0.5815153 0.5939273 0.6234609 0.8834840</span></span>
<span><span class="co">#&gt; [3,] 0.08775281 0.3553781 0.3918241 0.4196264 0.4209570 0.5525234 0.6148038</span></span>
<span><span class="co">#&gt; [4,] 0.19200301 0.2799162 0.3053224 0.5576230 0.8803338 1.0122411 1.0694339</span></span>
<span><span class="co">#&gt;           [,8]</span></span>
<span><span class="co">#&gt; [1,] 0.4993756</span></span>
<span><span class="co">#&gt; [2,] 0.8933141</span></span>
<span><span class="co">#&gt; [3,] 0.7221735</span></span>
<span><span class="co">#&gt; [4,] 1.0731836</span></span>
<span><span class="va">res1</span><span class="op">$</span><span class="va">nn.idx</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">#&gt; [1,]   54   18    8   27   19   30   31   28</span></span>
<span><span class="co">#&gt; [2,]   63   82   74   58   81   45   42   88</span></span>
<span><span class="co">#&gt; [3,]   25   37    6   41   89    7   80   33</span></span>
<span><span class="co">#&gt; [4,]   93   87   52   12   29   85    1   40</span></span></code></pre></div>
<p>Now we suppose that both variables should be wrapped, on the ranges
<span class="math inline">\((0, 2\pi)\)</span> and <span class="math inline">\((0, 3)\)</span> respectively. The points shaded in
green illustrate the effect of wrapping in both variables.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nnt.html">nnt</a></span><span class="op">(</span><span class="va">DATA</span>, <span class="va">query</span>, k <span class="op">=</span> <span class="fl">8</span>, torus <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, ranges <span class="op">=</span> <span class="va">ranges</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span></span></code></pre></div>
<p><img src="donut-vignette_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>The argument <code>fn</code> can be used to choose the function that
finds nearest neighbour distances. For example, we could choose
<code><a href="https://rdrr.io/pkg/nabor/man/knn.html" class="external-link">nabor::knn()</a></code>. Any function can be used provided that it has
syntax consistent with a call
<code>fn(data = data, query = query, k = k, ...)</code>. The following
code produce the same output as <code>fn = RANN::nn2</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jefferis/nabor" class="external-link">nabor</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'nabor' was built under R version 4.2.3</span></span>
<span><span class="va">ranges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1.3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nnt.html">nnt</a></span><span class="op">(</span><span class="va">DATA</span>, <span class="va">query</span>, k <span class="op">=</span> <span class="fl">8</span>, fn <span class="op">=</span> <span class="fu">nabor</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/nabor/man/knn.html" class="external-link">knn</a></span>, torus <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, ranges <span class="op">=</span> <span class="va">ranges</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">res2</span><span class="op">)</span></span></code></pre></div>
<p><img src="donut-vignette_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script><div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-RANN" class="csl-entry">
Arya, Sunil, David Mount, Samuel E. Kemp, and Gregory Jefferis. 2019.
<em>RANN: Fast Nearest Neighbour Search (Wraps ANN Library) Using L2
Metric</em>. <a href="https://CRAN.R-project.org/package=RANN" class="external-link">https://CRAN.R-project.org/package=RANN</a>.
</div>
<div id="ref-nabor" class="csl-entry">
Elseberg, J., S. Magnenat, R. Siegwart, and A. Nüchter. 2012.
<span>“Comparison of Nearest-Neighbor-Search Strategies and
Implementations for Efficient Shape Registration.”</span> <em>Journal of
Software Engineering for Robotics (JOSER)</em> 3 (1): 2–12. <a href="https://CRAN.R-project.org/package=nabor" class="external-link">https://CRAN.R-project.org/package=nabor</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul J. Northrop.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
